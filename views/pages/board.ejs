<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">

    <title>Your cards</title>
    <link rel='stylesheet' href='/stylesheets/style.css'/>
</head>
<body>
<%- include ../partials/header.ejs %>

<div class="container">
    <h2><em><%= board.name %></em></h2>

    <div class="row align-items-center">
        <div class="col">
            <a href="/boards">&laquo; Back to Board Overview</a>
        </div>
        <div class="col">
        </div>
        <div class="col">
            <a class="btn" data-toggle="modal" data-target="#settingsModal" role="button" id="settings">&#9881;Settings</a>
        </div>
    </div>

<div class="card table-card">
  <div class="table-responsive">
      <table class="table table-striped table-dark">
          <thead>
          <tr>
              <th scope="col">Title</th>
              <% board.columns.forEach( function (column) {
                if(board.trackedColumns.includes(column.id)){%>
                <th scope="col"><%= column.name %></th>
              <% }}); %>
              <th scope="col">Total time</th>
          </tr>
          </thead>
          <tbody>

          <% cards.forEach( function (card) { %>
              <!-- TODO: include times -->
              <tr>
                  <th scope="row"><%= card.name %></th>
                  <% board.columns.forEach( function (column) {
                  if(board.trackedColumns.includes(column.id)){%>
                      <td><%= card.columnTimes[column.name] %></td>
                  <% }}); %>
                  <td><%= card.totalTime %></td>
              </tr>
          <% }); %>
          </tbody>
      </table>
  </div>
</div>
         <p>Your personal time is displayed in the first line, whilst the second line indicates the team overall.</p>
</div>

<!-- Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" role="dialog" aria-labelledby="settingsModalTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <form action="/boards/<%= board.id %>" method="post">
                <div class="modal-header">
                    <h5 class="modal-title" id="settingsModalTitle">Board Settings</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="custom-control custom-switch">
                        <input type="checkbox" class="custom-control-input" id="switchTracking" name="trackingEnabled"<% if (board.trackingEnabled) { %>
                          checked="checked"
                        <% } %>  >
                        <label class="custom-control-label" for="switchTracking">Timetrack this board</label>
                    </div>


                    <div id="onlyonactive">
                        <hr>

                        <div class="custom-control custom-switch">
                            <input type="checkbox" class="custom-control-input" id="customSwitch2" name="chatbotEnabled">
                            <label class="custom-control-label" for="customSwitch2">Enable Chatbot</label>
                        </div>

                        <hr>

                        <label>Select Columns to Track</label>
                        <% board.columns.forEach( function (column, index) { %>
                            <div class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input" id="customCheck<%= index %>" value="<%= column.id %>" name="trackedColumns[]" <%if (board.trackedColumns.includes(column.id)){%>checked="checked"<% } %>>
                                <label class="custom-control-label"
                                       for="customCheck<%= index %>"> <%= column.name %></label>
                            </div>
                        <% }); %>
                        <hr>
                        <div class="form-group">
                          <label for="ProjectId">Choose Toggl Project</label>
                          <select class="form-control" id="ProjectId" name="togglProjectId">
                            <% workspaces.forEach(function(workspace, index){ %>
                              <optgroup label="<%= workspace.name%>">
                              <% if(workspace.projects){
                                  workspace.projects.forEach(function(project){
                                  %>
                                  <option value="<%= project.id%>" <%
                                    if(board.togglProjectId===project.id){%>selected<%} %>><%= project.name %></option>
                                  <%
                                });}}); %>
                          </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-danger" id="saveModalChanges">Save changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
<script src="/javascripts/switch.js"></script>
</body>
</html>
